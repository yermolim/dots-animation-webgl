!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).dotsAnim={})}(this,(function(t){"use strict";class e{constructor(t=0,e=0){this.length=2,this.x=t,this.y=e}static multiplyByScalar(t,i){return new e(t.x*i,t.y*i)}static addScalar(t,i){return new e(t.x+i,t.y+i)}static normalize(t){return(new e).setFromVec2(t).normalize()}static add(t,i){return new e(t.x+i.x,t.y+i.y)}static substract(t,i){return new e(t.x-i.x,t.y-i.y)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,i){return t.clone().lerp(e,i)}static rotate(t,e,i){return t.clone().rotate(e,i)}static equals(t,e,i=6){return t.equals(e)}static getDistance(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}clone(){return new e(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return e.dotProduct(this,t)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:i}=this,[s,r,,n,o,,a,h]=t;return this.x=e*s+i*n+a,this.y=e*r+i*o+h,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this}rotate(t,e){const i=Math.sin(e),s=Math.cos(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*s-n*i+t.x,this.y=r*i+n*s+t.y,this}equals(t,e=6){return+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class i{constructor(t=null){this.expectedFps=60,this.number=null,this.density=5e-5,this.dprDependentDensity=!0,this.dprDependentDimensions=!0,this.minR=1,this.maxR=6,this.minSpeedX=-.5,this.maxSpeedX=.5,this.minSpeedY=-.5,this.maxSpeedY=.5,this.blur=1,this.fill=!0,this.colorsFill=["#ffffff","#fff4c1","#faefdb"],this.opacityFill=null,this.opacityFillMin=0,this.opacityFillStep=0,this.stroke=!1,this.colorsStroke=["#ffffff"],this.opacityStroke=1,this.opacityStrokeMin=0,this.opacityStrokeStep=0,this.drawLines=!0,this.lineColor="#717892",this.lineLength=150,this.lineWidth=2,this.actionOnClick=!0,this.actionOnHover=!0,this.onClickCreate=!1,this.onClickMove=!0,this.onHoverMove=!0,this.onHoverDrawLines=!0,this.onClickCreateNDots=10,this.onClickMoveRadius=200,this.onHoverMoveRadius=50,this.onHoverLineRadius=150,t&&Object.assign(this,t)}}const s=35632,r=35633,n=34962,o=5120,a=5121,h=5122,l=5123,c=5124,_=5125,f=5126,u=35670,d={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4},m=35664,g=35665,p=35666,y=35674,w=35675,v=35676,b=35667,x=35668,A=35669,S=35671,E=35672,F=35673;class U{constructor(t,e,i){this._gl=t,this._location=t.getAttribLocation(e,i),this._name=i}get name(){return this._name}get type(){return this._type}}class k extends U{constructor(t,e,i,s,r,...n){super(t,e,i),this._type=s||f,this.size=r||1,n?.length?(this.x=n[0]||0,this.y=n[1]||0,this.z=n[2]||0,this.w=n[3]||0):(this.x=0,this.y=0,this.z=0,this.w=0)}set(){switch(this._gl.disableVertexAttribArray(this._location),this._type){case f:switch(this.size){case 1:this._gl.vertexAttrib1f(this._location,this.x);break;case 2:this._gl.vertexAttrib2f(this._location,this.x,this.y);break;case 3:this._gl.vertexAttrib3f(this._location,this.x,this.y,this.z);break;case 4:this._gl.vertexAttrib4f(this._location,this.x,this.y,this.z,this.w);break;default:throw new Error("Incorrect constant value length")}break;default:throw new Error("Unsupported constant attribute type")}}destroy(){}}class T extends U{constructor(t,e,i,s,r=1,u=1,m=0,g=0,p=!1){let y;if(super(t,e,i),this.vectorSize=r,this.vectorNumber=u,this.stride=m,this.offset=g,this.normalize=p,s instanceof Int8Array)y=o;else if(s instanceof Uint8Array||s instanceof Uint8ClampedArray)y=a;else if(s instanceof Int16Array)y=h;else if(s instanceof Uint16Array)y=l;else if(s instanceof Int32Array)y=c;else if(s instanceof Uint32Array)y=_;else{if(!(s instanceof Float32Array))throw new Error("Unsupported data array type");y=f}this._type=y,this._buffer=t.createBuffer(),this._gl.bindBuffer(n,this._buffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW);let w=0;1!==u?(w=r*u*d[y],this.vectorOffset=this.stride/u):this.vectorOffset=0,m<w?this.stride=w:m>255&&(this.stride=255)}set(){this._gl.bindBuffer(n,this._buffer);for(let t=0,e=this._location;t<this.vectorNumber;t++,e++)this._gl.enableVertexAttribArray(e),this._gl.vertexAttribPointer(e,this.vectorSize,this._type,this.normalize,this.stride,this.offset+t*this.vectorOffset)}destroy(){this._gl.deleteBuffer(this._buffer)}}class I{constructor(t,e,i){this._gl=t,this._location=t.getUniformLocation(e,this._name),this._name=i}get name(){return this._name}get type(){return this._type}setSampleArray(t,e,i){}}class P extends I{constructor(t,e,i,s,r){super(t,e,i),this._value=r,this._type=s}set(){this._gl.uniform1i(this._location,this._value)}destroy(){}}class C extends I{constructor(t,e,i,s){super(t,e,i),this._type=5126,this._value=s}set(){this._gl.uniform1f(this._location,this._value)}destroy(){}}class L extends I{constructor(t,e,i,s,r){switch(super(t,e,i),this._values=r,s){case c:case u:break;case b:case S:if(2!==r.length)throw new Error("Wrong values array length for a defined type");break;case x:case E:if(3!==r.length)throw new Error("Wrong values array length for a defined type");break;case A:case F:if(4!==r.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}this._type=s}set(){switch(this._type){case c:case u:this._gl.uniform1iv(this._location,this._values);break;case b:case S:this._gl.uniform2iv(this._location,this._values);break;case x:case E:this._gl.uniform3iv(this._location,this._values);break;case A:case F:this._gl.uniform4iv(this._location,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}}destroy(){}}class M extends I{constructor(t,e,i,s,r){switch(super(t,e,i),this._values=r,s){case f:break;case m:if(2!==r.length)throw new Error("Wrong values array length for a defined type");break;case g:if(3!==r.length)throw new Error("Wrong values array length for a defined type");break;case p:case y:if(4!==r.length)throw new Error("Wrong values array length for a defined type");break;case w:if(9!==r.length)throw new Error("Wrong values array length for a defined type");break;case v:if(16!==r.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}this._type=s}set(){switch(this._type){case f:this._gl.uniform1fv(this._location,this._values);break;case m:this._gl.uniform2fv(this._location,this._values);break;case g:this._gl.uniform3fv(this._location,this._values);break;case p:this._gl.uniform4fv(this._location,this._values);break;case y:this._gl.uniformMatrix2fv(this._location,!1,this._values);break;case w:this._gl.uniformMatrix3fv(this._location,!1,this._values);break;case v:this._gl.uniformMatrix4fv(this._location,!1,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}}destroy(){}}class z{constructor(t,e,i){this._attributes=new Map,this._uniforms=new Map;const n=z.loadShader(t,r,e),o=z.loadShader(t,s,i),a=t.createProgram();t.attachShader(a,n),t.attachShader(a,o),this._gl=t,this._program=a,t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS)){const e=t.getProgramInfoLog(a);throw this.destroy(),new Error("Error while linking program: "+e)}}static loadShader(t,e,i){const s=t.createShader(e);t.shaderSource(s,i),t.compileShader(s);if(!t.getShaderParameter(s,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(s);throw t.deleteShader(s),new Error("Error while compiling shader: "+e)}return s}render(t,e,i=!0){i&&this.clear(),this._gl.useProgram(this._program),this._attributes.forEach((t=>t.set())),this._uniforms.forEach((t=>t.set())),this._gl.drawArrays(this._gl.TRIANGLES,3*t,3*e)}clear(){this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.DEPTH_TEST),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT)}destroy(){this.clearUniforms(),this.clearAttributes(),this._gl.deleteProgram(this._program),this._gl.deleteShader(this._vertexShader),this._gl.deleteShader(this._fragmentShader)}setConstantScalarAttribute(t,e){if(isNaN(e))return;const i=new k(this._gl,this._program,t,f,1,e);this.setAttribute(i)}setConstantVecAttribute(t,e){if(!e)return;const i=e.toFloatArray(),s=new k(this._gl,this._program,t,f,i.length,...i);this.setAttribute(s)}setBufferAttribute(t,e,i=1,s=1,r=0,n=0,o=!1){if(!e?.length)return;const a=new T(this._gl,this._program,t,e,i,s,r,n,o);this.setAttribute(a)}deleteAttribute(t){const e=this._attributes.get(t);e&&(e.destroy(),this._attributes.delete(t))}clearAttributes(){this._attributes.forEach(((t,e)=>this.deleteAttribute(e)))}setBoolUniform(t,e){const i=new P(this._gl,this._program,t,c,e?1:0);this.setUniform(i)}setBoolArrayUniform(t,e){if(!e?.length)return;const i=new Int32Array(e.length);for(let t=0;t<e.length;t++)i[t]=e[t]?1:0;const s=new L(this._gl,this._program,t,u,i);this.setUniform(s)}setIntUniform(t,e){const i=new P(this._gl,this._program,t,c,e);this.setUniform(i)}setIntArrayUniform(t,e){if(!e?.length)return;const i=new L(this._gl,this._program,t,c,e);this.setUniform(i)}setIntVecUniform(t,e){if(!e)return;let i;switch(e.length){case 2:i=b;break;case 3:i=x;break;case 4:i=A;break;default:throw new Error("Incorrect vector length")}const s=new L(this._gl,this._program,t,i,e.toIntArray());this.setUniform(s)}setFloatUniform(t,e){const i=new C(this._gl,this._program,t,e);this.setUniform(i)}setFloatArrayUniform(t,e){if(!e?.length)return;const i=new M(this._gl,this._program,t,f,e);this.setUniform(i)}setFloatVecUniform(t,e){if(!e)return;let i;switch(e.length){case 2:i=m;break;case 3:i=g;break;case 4:i=p;break;default:throw new Error("Incorrect vector length")}const s=new M(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(s)}setFloatMatUniform(t,e){if(!e)return;let i;switch(e.length){case 4:i=y;break;case 9:i=w;break;case 16:i=v;break;default:throw new Error("Incorrect matrix length")}const s=new M(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(s)}setTexture(){}setTextureArray(){}deleteUniform(t){const e=this._uniforms.get(t);e&&(e.destroy(),this._uniforms.delete(t))}clearUniforms(){this._uniforms.forEach(((t,e)=>this.deleteUniform(e)))}setAttribute(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._attributes.set(t.name,t)}setUniform(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._uniforms.set(t.name,t)}}class R{constructor(t,i,s){this._resolution=new e,this._pointerPosition=new e,this._animationStartTimeStamp=0,this._lastFrameTimeStamp=0,this._lastFrameTime=0,this._lastFramePreparationTime=0,this._lastFrameRenderTime=0,this.onResize=t=>{const e=window.devicePixelRatio,i=this._container.getBoundingClientRect(),s=i.width*e,r=i.height*e;this._canvas.width=s,this._canvas.height=r,this._resolution.set(s,r)},this.onPointerMove=t=>{const e=window.devicePixelRatio,i=this._container.getBoundingClientRect(),s=i.left+document.documentElement.scrollLeft,r=i.top+document.documentElement.scrollTop,n=(t.clientX-s+window.pageXOffset)*e,o=(t.clientY-r+window.pageYOffset)*e;this._pointerPosition.set(n,o)},this.onPointerDown=t=>{this._pointerIsDown=!0},this.onPointerUp=()=>{this._pointerIsDown=!1},this._options=i,this._container=t,this._controlType=s,this.initCanvas(),this.initControl(),this.addEventListeners()}destroy(){this.stop(),this.removeEventListeners(),this._control.destroy(),this._canvas.remove()}start(){if(this._animationStartTimeStamp){const t=performance.now()-this._lastFrameTimeStamp;this._animationStartTimeStamp+=t}this._animationTimerId=setInterval((()=>{const t=performance.now(),e=t-this._animationStartTimeStamp;this._control.prepareNextFrame(this._resolution,this._pointerPosition,this._pointerIsDown,e),this._lastFramePreparationTime=performance.now()-t,console.log(this._lastFramePreparationTime),requestAnimationFrame((()=>{const e=performance.now();this._control.renderFrame();const i=performance.now();this._lastFrameTimeStamp=i,this._lastFrameRenderTime=i-e,this._lastFrameTime=i-t}))}),1e3/this._options.expectedFps)}pause(){this._animationTimerId&&(clearInterval(this._animationTimerId),this._animationTimerId=null)}stop(){this.pause(),this._animationStartTimeStamp=0,window.setTimeout((()=>this._control.clear()),20)}initCanvas(){const t=document.createElement("canvas");t.id=crypto.getRandomValues(new Uint32Array(4)).join("-"),t.style.display="block",t.style.width="100%",t.style.height="100%",t.style.filter=`blur(${this._options.blur}px)`,this._container.append(t),this._canvas=t,this.onResize(null)}initControl(){this._control=new this._controlType(this._canvas.getContext("webgl"),this._options)}addEventListeners(){this._resizeObserver=new ResizeObserver(this.onResize),this._resizeObserver.observe(this._container),this._container.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointerup",this.onPointerUp),window.addEventListener("blur",this.onPointerUp)}removeEventListeners(){this._resizeObserver.unobserve(this._container),this._resizeObserver.disconnect(),this._resizeObserver=null,this._container.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("blur",this.onPointerUp)}}class B{constructor(t,e){this._vertexShader="\n    #pragma vscode_glsllint_stage : vert\n\n    attribute vec4 position;\n\n    void main() {\n      gl_Position = position;\n    }\n  ",this._fragmentShader="\n    #pragma vscode_glsllint_stage : frag  \n\n    precision mediump float;\n\n    void main() {\n      gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n  ",this._options=e,this._gl=t,this._gl.isContextLost()&&this._gl.getExtension("WEBGL_lose_context").restoreContext(),this._program=new z(t,this._vertexShader,this._fragmentShader),this._tempData=new Float32Array([.1,.5,0,1,.3,.1,0,1,.3,.5,0,1]),this._program.setBufferAttribute("position",this._tempData,4)}prepareNextFrame(t,e,i,s){this.resize(t)}renderFrame(){this._program.render(0,1)}clear(){this._program.clear()}destroy(){this._program.destroy(),this._gl.getExtension("WEBGL_lose_context").loseContext()}resize(t){this._gl.canvas.width!==t.x&&(this._gl.canvas.width=t.x),this._gl.canvas.height!==t.y&&(this._gl.canvas.height=t.y)}}t.AnimationFactory=class{static createDotsAnimation(t,e=null){const s=document.querySelector(t);if(!s)throw new Error("Container not found");if("static"===window.getComputedStyle(s).getPropertyValue("position"))throw new Error("Container is not positioned");const r=new i(e);return new R(s,r,B)}},Object.defineProperty(t,"__esModule",{value:!0})}));
