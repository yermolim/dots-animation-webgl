!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).dotsAnim={})}(this,(function(t){"use strict";function e(t,e){return Math.random()*(e-t)+t}function i(t){return t*Math.PI/180}function s(t,e,i){return Math.max(e,Math.min(t,i))}function r(t){return 0==(t&t-1)}class n{constructor(t=0,e=0,i=0,s=1){this.x=t,this.y=e,this.z=i,this.w=s}static fromRotationMatrix(t){return(new n).setFromRotationMatrix(t)}static fromEuler(t){return(new n).setFromEuler(t)}static fromVec3Angle(t,e){return(new n).setFromVec3Angle(t,e)}static fromVec3s(t,e){return(new n).setFromVec3s(t,e)}static normalize(t){return t.clone().normalize()}static invert(t){return t.clone().normalize().invert()}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static getAngle(t,e){return t.getAngle(e)}static multiply(t,e){return t.clone().multiply(e)}static slerp(t,e,i){return t.clone().slerp(e,i)}static equals(t,e,i=6){return t.equals(e,i)}clone(){return new n(this.x,this.y,this.z,this.w)}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setFromVec3s(t,e){t=t.clone().normalize(),e=e.clone().normalize();let i=t.dotProduct(e)+1;if(i<1e-6)i=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0):(this.x=0,this.y=-t.z,this.z=t.y);else{const{x:i,y:s,z:r}=t.crossProduct(e);this.x=i,this.y=s,this.z=r}return this.w=i,this.normalize()}setFromQ(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}setFromRotationMatrix(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const[e,i,s,r,n,a,o,h,_,l,c,u,x,y,m,d]=t,w=e+a+c;if(w>0){const t=.5/Math.sqrt(1+w);this.set((o-l)*t,(_-s)*t,(i-n)*t,.25/t)}else if(e>a&&e>c){const t=2*Math.sqrt(1+e-a-c);this.set(.25*t,(n+i)/t,(_+s)/t,(o-l)/t)}else if(a>c){const t=2*Math.sqrt(1+a-e-c);this.set((n+i)/t,.25*t,(l+o)/t,(_-s)/t)}else{const t=2*Math.sqrt(1+c-e-a);this.set((_+s)/t,(l+o)/t,.25*t,(i-n)/t)}return this}setFromEuler(t){const e=Math.cos(t.x/2),i=Math.cos(t.y/2),s=Math.cos(t.z/2),r=Math.sin(t.x/2),n=Math.sin(t.y/2),a=Math.sin(t.z/2);switch(t.order){case"XYZ":this.x=r*i*s+e*n*a,this.y=e*n*s-r*i*a,this.z=e*i*a+r*n*s,this.w=e*i*s-r*n*a;break;case"XZY":this.x=r*i*s-e*n*a,this.y=e*n*s-r*i*a,this.z=e*i*a+r*n*s,this.w=e*i*s+r*n*a;break;case"YXZ":this.x=r*i*s+e*n*a,this.y=e*n*s-r*i*a,this.z=e*i*a-r*n*s,this.w=e*i*s+r*n*a;break;case"YZX":this.x=r*i*s+e*n*a,this.y=e*n*s+r*i*a,this.z=e*i*a-r*n*s,this.w=e*i*s-r*n*a;break;case"ZXY":this.x=r*i*s-e*n*a,this.y=e*n*s+r*i*a,this.z=e*i*a+r*n*s,this.w=e*i*s-r*n*a;break;case"ZYX":this.x=r*i*s-e*n*a,this.y=e*n*s+r*i*a,this.z=e*i*a-r*n*s,this.w=e*i*s+r*n*a}return this}setFromVec3Angle(t,e){const i=t.clone().normalize(),s=e/2,r=Math.sin(s);return this.x=i.x*r,this.y=i.y*r,this.z=i.z*r,this.w=Math.cos(s),this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}invert(){return this.normalize(),this.x*=-1,this.y*=-1,this.z*=-1,this}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}getAngle(t){return 2*Math.acos(Math.abs(s(this.dotProduct(t),-1,1)))}multiply(t){const{x:e,y:i,z:s,w:r}=this,{x:n,y:a,z:o,w:h}=t;return this.x=e*h+r*n+i*o-s*a,this.y=i*h+r*a+s*n-e*o,this.z=s*h+r*o+e*a-i*n,this.w=r*h-e*n-i*a-s*o,this}slerp(t,e){if(!(e=s(e,0,1)))return this;if(1===e)return this.setFromQ(t);const{x:i,y:r,z:n,w:a}=this,{x:o,y:h,z:_,w:l}=t,c=i*o+r*h+n*_+a*l;if(Math.abs(c)>=1)return this;const u=Math.acos(c),x=Math.sin(u);if(Math.abs(x)<1e-6)return this.x=.5*(i+o),this.y=.5*(r+h),this.z=.5*(n+_),this.w=.5*(a+l),this;const y=Math.sin((1-e)*u)/x,m=Math.sin(e*u)/x;return this.x=y*i+m*o,this.y=y*r+m*h,this.z=y*n+m*_,this.w=y*a+m*l,this}equals(t,e=6){return+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)&&+this.z.toFixed(e)==+t.z.toFixed(e)&&+this.w.toFixed(e)==+t.w.toFixed(e)}}class a{constructor(t=0,e=0,i=0){this.length=3,this.x=t,this.y=e,this.z=i}static multiplyByScalar(t,e){return new a(t.x*e,t.y*e,t.z*e)}static addScalar(t,e){return new a(t.x+e,t.y+e,t.z+e)}static normalize(t){return(new a).setFromVec3(t).normalize()}static add(t,e){return new a(t.x+e.x,t.y+e.y,t.z+e.z)}static substract(t,e){return new a(t.x-e.x,t.y-e.y,t.z-e.z)}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static crossProduct(t,e){return new a(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static onVector(t,e){return t.clone().onVector(e)}static onPlane(t,e){return t.clone().onPlane(e)}static applyMat3(t,e){return t.clone().applyMat3(e)}static applyMat4(t,e){return t.clone().applyMat4(e)}static lerp(t,e,i){return t.clone().lerp(e,i)}static equals(t,e,i=6){return!!t&&t.equals(e,i)}static getDistance(t,e){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return Math.sqrt(i*i+s*s+r*r)}static getAngle(t,e){return t.getAngle(e)}clone(){return new a(this.x,this.y,this.z)}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setFromVec3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getAngle(t){const e=this.getMagnitude()*t.getMagnitude();if(!e)return Math.PI/2;const i=this.dotProduct(t)/e;return Math.acos(s(i,-1,1))}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}dotProduct(t){return a.dotProduct(this,t)}crossProduct(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x,this}onVector(t){const e=this.getMagnitude();return e?t.clone().multiplyByScalar(t.clone().dotProduct(this)/(e*e)):this.set(0,0,0)}onPlane(t){return this.substract(this.clone().onVector(t))}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:i,z:s}=this,[r,n,a,o,h,_,l,c,u]=t;return this.x=e*r+i*o+s*l,this.y=e*n+i*h+s*c,this.z=e*a+i*_+s*u,this}applyMat4(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const{x:e,y:i,z:s}=this,[r,n,a,o,h,_,l,c,u,x,y,m,d,w,g,f]=t,p=1/(e*o+i*c+s*m+f);return this.x=(e*r+i*h+s*u+d)*p,this.y=(e*n+i*_+s*x+w)*p,this.z=(e*a+i*l+s*y+g)*p,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this}equals(t,e=6){return!!t&&(+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)&&+this.z.toFixed(e)==+t.z.toFixed(e))}toArray(){return[this.x,this.y,this.z]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class o{constructor(){this.length=16,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=1,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=1,this._matrix[11]=0,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=0,this._matrix[15]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get x_w(){return this._matrix[3]}get y_x(){return this._matrix[4]}get y_y(){return this._matrix[5]}get y_z(){return this._matrix[6]}get y_w(){return this._matrix[7]}get z_x(){return this._matrix[8]}get z_y(){return this._matrix[9]}get z_z(){return this._matrix[10]}get z_w(){return this._matrix[11]}get w_x(){return this._matrix[12]}get w_y(){return this._matrix[13]}get w_z(){return this._matrix[14]}get w_w(){return this._matrix[15]}static fromMat4(t){return(new o).setFromMat4(t)}static fromTRS(t,e,i){return(new o).setFromTRS(t,e,i)}static fromQuaternion(t){return(new o).setFromQuaternion(t)}static multiply(t,e){const i=new o;return i.set(t.x_x*e.x_x+t.x_y*e.y_x+t.x_z*e.z_x+t.x_w*e.w_x,t.x_x*e.x_y+t.x_y*e.y_y+t.x_z*e.z_y+t.x_w*e.w_y,t.x_x*e.x_z+t.x_y*e.y_z+t.x_z*e.z_z+t.x_w*e.w_z,t.x_x*e.x_w+t.x_y*e.y_w+t.x_z*e.z_w+t.x_w*e.w_w,t.y_x*e.x_x+t.y_y*e.y_x+t.y_z*e.z_x+t.y_w*e.w_x,t.y_x*e.x_y+t.y_y*e.y_y+t.y_z*e.z_y+t.y_w*e.w_y,t.y_x*e.x_z+t.y_y*e.y_z+t.y_z*e.z_z+t.y_w*e.w_z,t.y_x*e.x_w+t.y_y*e.y_w+t.y_z*e.z_w+t.y_w*e.w_w,t.z_x*e.x_x+t.z_y*e.y_x+t.z_z*e.z_x+t.z_w*e.w_x,t.z_x*e.x_y+t.z_y*e.y_y+t.z_z*e.z_y+t.z_w*e.w_y,t.z_x*e.x_z+t.z_y*e.y_z+t.z_z*e.z_z+t.z_w*e.w_z,t.z_x*e.x_w+t.z_y*e.y_w+t.z_z*e.z_w+t.z_w*e.w_w,t.w_x*e.x_x+t.w_y*e.y_x+t.w_z*e.z_x+t.w_w*e.w_x,t.w_x*e.x_y+t.w_y*e.y_y+t.w_z*e.z_y+t.w_w*e.w_y,t.w_x*e.x_z+t.w_y*e.y_z+t.w_z*e.z_z+t.w_w*e.w_z,t.w_x*e.x_w+t.w_y*e.y_w+t.w_z*e.z_w+t.w_w*e.w_w),i}static multiplyScalar(t,e){const i=new o;for(let s=0;s<this.length;s++)i._matrix[s]=t._matrix[s]*e;return i}static transpose(t){const e=new o;return e.set(t.x_x,t.y_x,t.z_x,t.w_x,t.x_y,t.y_y,t.z_y,t.w_y,t.x_z,t.y_z,t.z_z,t.w_z,t.x_w,t.y_w,t.z_w,t.w_w),e}static invert(t){const e=1/t.getDeterminant(),[i,s,r,n,a,h,_,l,c,u,x,y,m,d,w,g]=t._matrix;return(new o).set((_*y*d-l*x*d+l*u*w-h*y*w-_*u*g+h*x*g)*e,(n*x*d-r*y*d-n*u*w+s*y*w+r*u*g-s*x*g)*e,(r*l*d-n*_*d+n*h*w-s*l*w-r*h*g+s*_*g)*e,(n*_*u-r*l*u-n*h*x+s*l*x+r*h*y-s*_*y)*e,(l*x*m-_*y*m-l*c*w+a*y*w+_*c*g-a*x*g)*e,(r*y*m-n*x*m+n*c*w-i*y*w-r*c*g+i*x*g)*e,(n*_*m-r*l*m-n*a*w+i*l*w+r*a*g-i*_*g)*e,(r*l*c-n*_*c+n*a*x-i*l*x-r*a*y+i*_*y)*e,(h*y*m-l*u*m+l*c*d-a*y*d-h*c*g+a*u*g)*e,(n*u*m-s*y*m-n*c*d+i*y*d+s*c*g-i*u*g)*e,(s*l*m-n*h*m+n*a*d-i*l*d-s*a*g+i*h*g)*e,(n*h*c-s*l*c-n*a*u+i*l*u+s*a*y-i*h*y)*e,(_*u*m-h*x*m-_*c*d+a*x*d+h*c*w-a*u*w)*e,(s*x*m-r*u*m+r*c*d-i*x*d-s*c*w+i*u*w)*e,(r*h*m-s*_*m-r*a*d+i*_*d+s*a*w-i*h*w)*e,(s*_*c-r*h*c+r*a*u-i*_*u-s*a*x+i*h*x)*e)}static lookAt(t,e,i){const s=a.equals(t,e)?new a(0,0,1):a.substract(t,e).normalize();let r=a.crossProduct(i,s).normalize();r.getMagnitude()||(1===Math.abs(i.z)?s.x+=1e-5:s.z+=1e-5,s.normalize(),r=a.crossProduct(i,s).normalize());const n=a.crossProduct(s,r).normalize();return(new o).set(r.x,r.y,r.z,0,n.x,n.y,n.z,0,s.x,s.y,s.z,0,t.x,t.y,t.z,1)}static buildScale(t,e,i){return e??(e=t),i??(i=t),(new o).set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)}static buildRotationX(t){const e=Math.cos(t),i=Math.sin(t);return(new o).set(1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1)}static buildRotationY(t){const e=Math.cos(t),i=Math.sin(t);return(new o).set(e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1)}static buildRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return(new o).set(e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1)}static buildTranslate(t,e,i){return(new o).set(1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1)}static buildOrthographic(t,e,i,s,r,n){return(new o).set(2/(s-i),0,0,0,0,2/(n-r),0,0,0,0,2/(t-e),0,(i+s)/(i-s),(r+n)/(r-n),(t+e)/(t-e),1)}static buildPerspective(t,e,...i){if(4===i.length){const[s,r,n,a]=i;return(new o).set(2*t/(r-s),0,0,0,0,2*t/(a-n),0,0,(r+s)/(r-s),(a+n)/(a-n),(t+e)/(t-e),-1,0,0,2*t*e/(t-e),0)}if(2===i.length){const[s,r]=i,n=Math.tan(.5*Math.PI-.5*s);return(new o).set(n/r,0,0,0,0,n,0,0,0,0,(t+e)/(t-e),-1,0,0,2*t*e/(t-e),0)}throw new Error("Incorrect args quantity")}static equals(t,e,i=6){return t.equals(e,i)}clone(){return(new o).set(this.x_x,this.x_y,this.x_z,this.x_w,this.y_x,this.y_y,this.y_z,this.y_w,this.z_x,this.z_y,this.z_z,this.z_w,this.w_x,this.w_y,this.w_z,this.w_w)}set(t,e,i,s,r,n,a,o,h,_,l,c,u,x,y,m){return this._matrix[0]=t,this._matrix[1]=e,this._matrix[2]=i,this._matrix[3]=s,this._matrix[4]=r,this._matrix[5]=n,this._matrix[6]=a,this._matrix[7]=o,this._matrix[8]=h,this._matrix[9]=_,this._matrix[10]=l,this._matrix[11]=c,this._matrix[12]=u,this._matrix[13]=x,this._matrix[14]=y,this._matrix[15]=m,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=1,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=1,this._matrix[11]=0,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=0,this._matrix[15]=1,this}setFromMat4(t){for(let e=0;e<this.length;e++)this._matrix[e]=t._matrix[e];return this}setFromTRS(t,e,i){const s=2*e.x*e.x,r=2*e.y*e.x,n=2*e.z*e.x,a=2*e.y*e.y,o=2*e.z*e.y,h=2*e.z*e.z,_=2*e.x*e.w,l=2*e.y*e.w,c=2*e.z*e.w;return this.set((1-a-h)*i.x,(r+c)*i.x,(n-l)*i.x,0,(r-c)*i.y,(1-s-h)*i.y,(o+_)*i.y,0,(n+l)*i.z,(o-_)*i.z,(1-s-a)*i.z,0,t.x,t.y,t.z,1),this}setFromQuaternion(t){return this.setFromTRS(new a(0,0,0),t,new a(1,1,1))}multiply(t){const[e,i,s,r,n,a,o,h,_,l,c,u,x,y,m,d]=this._matrix,[w,g,f,p,z,v,b,A,M,E,T,F,S,U,I,P]=t._matrix;return this._matrix[0]=e*w+i*z+s*M+r*S,this._matrix[1]=e*g+i*v+s*E+r*U,this._matrix[2]=e*f+i*b+s*T+r*I,this._matrix[3]=e*p+i*A+s*F+r*P,this._matrix[4]=n*w+a*z+o*M+h*S,this._matrix[5]=n*g+a*v+o*E+h*U,this._matrix[6]=n*f+a*b+o*T+h*I,this._matrix[7]=n*p+a*A+o*F+h*P,this._matrix[8]=_*w+l*z+c*M+u*S,this._matrix[9]=_*g+l*v+c*E+u*U,this._matrix[10]=_*f+l*b+c*T+u*I,this._matrix[11]=_*p+l*A+c*F+u*P,this._matrix[12]=x*w+y*z+m*M+d*S,this._matrix[13]=x*g+y*v+m*E+d*U,this._matrix[14]=x*f+y*b+m*T+d*I,this._matrix[15]=x*p+y*A+m*F+d*P,this}multiplyScalar(t){for(let e=0;e<this.length;e++)this._matrix[e]*=t;return this}transpose(){const t=(new o).setFromMat4(this);return this.set(t.x_x,t.y_x,t.z_x,t.w_x,t.x_y,t.y_y,t.z_y,t.w_y,t.x_z,t.y_z,t.z_z,t.w_z,t.x_w,t.y_w,t.z_w,t.w_w),this}invert(){const t=1/this.getDeterminant(),[e,i,s,r,n,a,o,h,_,l,c,u,x,y,m,d]=this._matrix;return this.set((o*u*y-h*c*y+h*l*m-a*u*m-o*l*d+a*c*d)*t,(r*c*y-s*u*y-r*l*m+i*u*m+s*l*d-i*c*d)*t,(s*h*y-r*o*y+r*a*m-i*h*m-s*a*d+i*o*d)*t,(r*o*l-s*h*l-r*a*c+i*h*c+s*a*u-i*o*u)*t,(h*c*x-o*u*x-h*_*m+n*u*m+o*_*d-n*c*d)*t,(s*u*x-r*c*x+r*_*m-e*u*m-s*_*d+e*c*d)*t,(r*o*x-s*h*x-r*n*m+e*h*m+s*n*d-e*o*d)*t,(s*h*_-r*o*_+r*n*c-e*h*c-s*n*u+e*o*u)*t,(a*u*x-h*l*x+h*_*y-n*u*y-a*_*d+n*l*d)*t,(r*l*x-i*u*x-r*_*y+e*u*y+i*_*d-e*l*d)*t,(i*h*x-r*a*x+r*n*y-e*h*y-i*n*d+e*a*d)*t,(r*a*_-i*h*_-r*n*l+e*h*l+i*n*u-e*a*u)*t,(o*l*x-a*c*x-o*_*y+n*c*y+a*_*m-n*l*m)*t,(i*c*x-s*l*x+s*_*y-e*c*y-i*_*m+e*l*m)*t,(s*a*x-i*o*x-s*n*y+e*o*y+i*n*m-e*a*m)*t,(i*o*_-s*a*_+s*n*l-e*o*l-i*n*c+e*a*c)*t),this}getDeterminant(){const[t,e,i,s,r,n,a,o,h,_,l,c,u,x,y,m]=this._matrix;return s*a*_*u-i*o*_*u-s*n*l*u+e*o*l*u+i*n*c*u-e*a*c*u-s*a*h*x+i*o*h*x+s*r*l*x-t*o*l*x-i*r*c*x+t*a*c*x+s*n*h*y-e*o*h*y-s*r*_*y+t*o*_*y+e*r*c*y-t*n*c*y-i*n*h*m+e*a*h*m+i*r*_*m-t*a*_*m-e*r*l*m+t*n*l*m}getTRS(){const t=new a(this.w_x,this.w_y,this.w_z),e=this.getDeterminant(),i=new a(this.x_x,this.x_y,this.x_z).getMagnitude()*(e<0?-1:1),s=new a(this.y_x,this.y_y,this.y_z).getMagnitude(),r=new a(this.z_x,this.z_y,this.z_z).getMagnitude(),h=new a(i,s,r),_=(new o).set(this.x_x/i,this.x_y/i,this.x_z/i,0,this.y_x/s,this.y_y/s,this.y_z/s,0,this.z_x/r,this.z_y/r,this.z_z/r,0,0,0,0,1);return{t:t,r:n.fromRotationMatrix(_),s:h}}equals(t,e=6){for(let i=0;i<this.length;i++)if(+this._matrix[i].toFixed(e)!=+t._matrix[i].toFixed(e))return!1;return!0}applyScaling(t,e,i){const s=o.buildScale(t,e,i);return this.multiply(s)}applyTranslation(t,e,i){const s=o.buildTranslate(t,e,i);return this.multiply(s)}applyRotation(t,e){let i;switch(t){case"x":default:i=o.buildRotationX(e);break;case"y":i=o.buildRotationY(e);break;case"z":i=o.buildRotationZ(e)}return this.multiply(i)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this._matrix[t]}}class h{constructor(t=0,e=0){this.length=2,this.x=t,this.y=e}static multiplyByScalar(t,e){return new h(t.x*e,t.y*e)}static addScalar(t,e){return new h(t.x+e,t.y+e)}static normalize(t){return(new h).setFromVec2(t).normalize()}static add(t,e){return new h(t.x+e.x,t.y+e.y)}static substract(t,e){return new h(t.x-e.x,t.y-e.y)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,i){return t.clone().lerp(e,i)}static rotate(t,e,i){return t.clone().rotate(e,i)}static equals(t,e,i=6){return!!t&&t.equals(e)}static getDistance(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}clone(){return new h(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return h.dotProduct(this,t)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:i}=this,[s,r,,n,a,,o,h]=t;return this.x=e*s+i*n+o,this.y=e*r+i*a+h,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this}rotate(t,e){const i=Math.sin(e),s=Math.cos(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*s-n*i+t.x,this.y=r*i+n*s+t.y,this}equals(t,e=6){return!!t&&(+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e))}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class _{constructor(t=0,e=0,i=0,s=1){this.length=4,this.x=t,this.y=e,this.z=i,this.w=s}static fromVec3(t){return new _(t.x,t.y,t.z)}static multiplyByScalar(t,e){return new _(t.x*e,t.y*e,t.z*e,t.w*e)}static addScalar(t,e){return new _(t.x+e,t.y+e,t.z+e,t.w+e)}static normalize(t){return(new _).setFromVec4(t).normalize()}static add(t,e){return new _(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)}static substract(t,e){return new _(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static applyMat4(t,e){return t.clone().applyMat4(e)}static lerp(t,e,i){return t.clone().lerp(e,i)}static equals(t,e,i=6){return!!t&&t.equals(e,i)}clone(){return new _(this.x,this.y,this.z,this.w)}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setFromVec3(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=1}setFromVec4(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}applyMat4(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const{x:e,y:i,z:s,w:r}=this,[n,a,o,h,_,l,c,u,x,y,m,d,w,g,f,p]=t;return this.x=e*n+i*_+s*x+r*w,this.y=e*a+i*l+s*y+r*g,this.z=e*o+i*c+s*m+r*f,this.w=e*h+i*u+s*d+r*p,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this}equals(t,e=6){return!!t&&(+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)&&+this.z.toFixed(e)==+t.z.toFixed(e)&&+this.w.toFixed(e)==+t.w.toFixed(e))}toArray(){return[this.x,this.y,this.z,this.w]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class l{constructor(t=null){this.expectedFps=60,this.fixedNumber=null,this.density=2e-4,this.depth=1e3,this.fov=120,this.size=[16,64],this.velocityX=[-.2,.2],this.velocityY=[-.2,.2],this.angularVelocity=[-.001,.001],this.blur=1,this.colors=[[255,255,255],[255,244,193],[250,239,219]],this.fixedOpacity=null,this.opacityMin=0,this.opacityStep=0,this.drawLines=!0,this.lineColor=[113,120,146],this.lineLength=150,this.lineWidth=2,this.onClick=null,this.onHover=null,this.onClickCreateN=10,this.onClickMoveR=200,this.onHoverMoveR=50,this.onHoverLineLength=150,this.textureUrl="animals-white.png",this.textureSize=8,this.textureMap=[0,0,1,0,2,0,3,0,4,0,5,0,6,0,7,0,0,1,1,1,2,1,3,1,4,1,5,1,6,1,7,1,0,2,1,2,2,2,3,2,4,2,5,2,6,2,7,2,0,3,1,3,2,3,3,3,4,3,5,3],t&&Object.assign(this,t)}}const c=35632,u=35633,x=34962,y=34963,m=33984,d=3553,w=34067,g=5121,f=5120,p=5121,z=5122,v=5123,b=5124,A=5125,M=5126,E=35670,T={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4},F=35664,S=35665,U=35666,I=35674,P=35675,R=35676,C=35667,D=35668,L=35669,k=35671,B=35672,V=35673,N=35678,q=35680,O=35682,X=36293,G=36298,W=36300,Y=36306,Z=36308,j=35044,H=35048;function Q(t){if(t instanceof Int8Array)return f;if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return p;if(t instanceof Int16Array)return z;if(t instanceof Uint16Array)return v;if(t instanceof Int32Array)return b;if(t instanceof Uint32Array)return A;if(t instanceof Float32Array)return M;throw new Error("Unsupported array type")}class ${constructor(t=1){this._positions=new Float32Array([-t,-t,0,t,-t,0,-t,t,0,t,t,0]),this._normals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),this._uvs=new Float32Array([0,1,1,1,0,0,1,0]),this._indices=new Uint32Array([0,1,2,2,1,3])}get positions(){return this._positions}get normals(){return this._normals}get uvs(){return this._uvs}get indices(){return this._indices}}class K{constructor(t,e,i){this._gl=t,this._location=t.getAttribLocation(e,i),this._name=i}get name(){return this._name}get type(){return this._type}}class J extends K{constructor(t,e,i,s){if(super(t,e,i),this._type=Q(s),this._size=s.length,![1,2,3,4,9,16].includes(this._size))throw new Error("Incorrect constant value length")}set(){switch(this._gl.disableVertexAttribArray(this._location),this._type){case M:switch(this._size){case 1:this._gl.vertexAttrib1f(this._location,this._values[0]);break;case 2:this._gl.vertexAttrib2fv(this._location,this._values);break;case 3:this._gl.vertexAttrib3fv(this._location,this._values);break;case 4:this._gl.vertexAttrib4fv(this._location,this._values);break;case 9:const[t,e,i,s,r,n,a,o,h]=this._values;this._gl.vertexAttrib3f(this._location,t,e,i),this._gl.vertexAttrib3f(this._location+1,s,r,n),this._gl.vertexAttrib3f(this._location+2,a,o,h);break;case 16:const[_,l,c,u,x,y,m,d,w,g,f,p,z,v,b,A]=this._values;this._gl.vertexAttrib4f(this._location,_,l,c,u),this._gl.vertexAttrib4f(this._location+1,x,y,m,d),this._gl.vertexAttrib4f(this._location+2,w,g,f,p),this._gl.vertexAttrib4f(this._location+3,z,v,b,A);break;default:throw new Error("Incorrect constant value length")}break;default:throw new Error("Unsupported constant attribute type")}}destroy(){}}class tt extends K{constructor(t,e,i,s,r,n){super(t,e,i),this._type=Q(s);const{usage:a,vectorSize:o,vectorNumber:h,stride:_,offset:l,normalize:c,divisor:u}=Object.assign({},tt.defaultOptions,r),y=h?o*h*T[this.type]:0;this._stride=Math.min(255,Math.max(y,_)),this._vectorOffset=this._stride&&h?this._stride/h:0,this._vectorSize=o,this._vectorNumber=h,this._offset=l,this._normalize=c,this._divisor=u,this._instancedExt=n,this._buffer=t.createBuffer(),t.bindBuffer(x,this._buffer),t.bufferData(x,s,a)}updateData(t,e){this._gl.bindBuffer(x,this._buffer),this._gl.bufferSubData(x,e,t)}set(){this._gl.bindBuffer(x,this._buffer);for(let t=0,e=this._location;t<this._vectorNumber;t++,e++)this._gl.enableVertexAttribArray(e),this._gl.vertexAttribPointer(e,this._vectorSize,this._type,this._normalize,this._stride,this._offset+t*this._vectorOffset),this._divisor&&this._instancedExt&&this._instancedExt.vertexAttribDivisorANGLE(e,this._divisor)}destroy(){this._gl.deleteBuffer(this._buffer)}}tt.defaultOptions={usage:j,vectorSize:1,vectorNumber:1,stride:0,offset:0,normalize:!1};class et extends K{constructor(t,e,i){let s;if(super(t,e,"index"),i instanceof Uint8Array||i instanceof Uint8ClampedArray)s=p;else if(i instanceof Uint16Array)s=v;else{if(!(i instanceof Uint32Array))throw new Error("Unsupported index type");s=A}this._type=s,this._buffer=t.createBuffer(),this._gl.bindBuffer(y,this._buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW)}set(){this._gl.bindBuffer(y,this._buffer)}destroy(){this._gl.deleteBuffer(this._buffer)}}class it{constructor(t,e,i){this._gl=t,this._location=t.getUniformLocation(e,i),this._name=i}get name(){return this._name}get type(){return this._type}setSampleArray(t,e,i){}}class st extends it{constructor(t,e,i,s,r){super(t,e,i),this._value=r,this._type=s}set(){this._gl.uniform1i(this._location,this._value)}destroy(){}}class rt extends it{constructor(t,e,i,s){super(t,e,i),this._type=5126,this._value=s}set(){this._gl.uniform1f(this._location,this._value)}destroy(){}}class nt extends it{constructor(t,e,i,s,r){switch(super(t,e,i),this._values=r,s){case b:case E:break;case C:case k:if(2!==r.length)throw new Error("Wrong values array length for a defined type");break;case D:case B:if(3!==r.length)throw new Error("Wrong values array length for a defined type");break;case L:case V:if(4!==r.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}this._type=s}set(){switch(this._type){case b:case E:this._gl.uniform1iv(this._location,this._values);break;case C:case k:this._gl.uniform2iv(this._location,this._values);break;case D:case B:this._gl.uniform3iv(this._location,this._values);break;case L:case V:this._gl.uniform4iv(this._location,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}}destroy(){}}class at extends it{constructor(t,e,i,s,r){switch(super(t,e,i),this._values=r,s){case M:break;case F:if(2!==r.length)throw new Error("Wrong values array length for a defined type");break;case S:if(3!==r.length)throw new Error("Wrong values array length for a defined type");break;case U:case I:if(4!==r.length)throw new Error("Wrong values array length for a defined type");break;case P:if(9!==r.length)throw new Error("Wrong values array length for a defined type");break;case R:if(16!==r.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}this._type=s}set(){switch(this._type){case M:this._gl.uniform1fv(this._location,this._values);break;case F:this._gl.uniform2fv(this._location,this._values);break;case S:this._gl.uniform3fv(this._location,this._values);break;case U:this._gl.uniform4fv(this._location,this._values);break;case I:this._gl.uniformMatrix2fv(this._location,!1,this._values);break;case P:this._gl.uniformMatrix3fv(this._location,!1,this._values);break;case R:this._gl.uniformMatrix4fv(this._location,!1,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}}destroy(){}}class ot extends it{constructor(t,e,i,s,r,n){switch(super(t,e,i),this._sampler=n,r){case N:case O:case G:case Y:this._target=d;break;case q:case X:case W:case Z:this._target=w;break;default:throw new Error("Unsupported sampler type "+r)}this._type=r,this._unit=s}}class ht extends ot{constructor(t,e,i,s,r,n,a){super(t,e,i,s,n,a),this._texture=r}set(){this._gl.uniform1i(this._location,this._unit),this._gl.activeTexture(m+this._unit),this._gl.bindTexture(this._target,this._texture)}destroy(){this._gl.deleteTexture(this._texture)}}class _t extends ot{constructor(t,e,i,s,r,n,a){super(t,e,i,s,n,a),this._textures=r}set(){const t=new Int32Array(this._textures.length);for(let e=0;e<this._textures.length;e++)t[e]=this._unit+e;this._gl.uniform1iv(this._location,t),this._textures.forEach(((e,i)=>{const s=m+t[i];this._gl.activeTexture(s),this._gl.bindTexture(this._target,e)}))}destroy(){this._textures.forEach((t=>this._gl.deleteTexture(t)))}}class lt{constructor(t,e,i){this._attributes=new Map,this._uniforms=new Map,this._offset=0,this._triangleCount=0;const s=lt.loadShader(t,u,e),r=lt.loadShader(t,c,i);this._extIndexed=t.getExtension("OES_element_index_uint");const n=t.createProgram();t.attachShader(n,s),t.attachShader(n,r),this._gl=t,this._program=n,t.linkProgram(n);if(!t.getProgramParameter(n,t.LINK_STATUS)){const e=t.getProgramInfoLog(n);throw this.destroy(),new Error("Error while linking program: "+e)}}get offset(){return this._offset}set offset(t){this._offset=Math.max(0,t)}get triangleCount(){return this._triangleCount}set triangleCount(t){this._triangleCount=Math.max(0,t)}static loadShader(t,e,i){const s=t.createShader(e);t.shaderSource(s,i),t.compileShader(s);if(!t.getShaderParameter(s,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(s);throw t.deleteShader(s),new Error("Error while compiling shader: "+e)}return s}render(t=!0){this._gl.viewport(0,0,this._gl.canvas.width,this._gl.canvas.height),t&&this.resetRender(),this.set();const e=this._attributes.get("index");e?this._gl.drawElements(this._gl.TRIANGLES,3*this._triangleCount,e.type,this._offset):this._gl.drawArrays(this._gl.TRIANGLES,this._offset,3*this._triangleCount)}resetRender(){const t=this._gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.cullFace(t.BACK),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}destroy(){this.clearUniforms(),this.clearAttributes(),this._gl.deleteProgram(this._program),this._gl.deleteShader(this._vertexShader),this._gl.deleteShader(this._fragmentShader)}setConstantScalarAttribute(t,e){if(!t||isNaN(e))return;const i=new J(this._gl,this._program,t,new Float32Array([e]));this.setAttribute(i)}setConstantVecAttribute(t,e){if(!t||!e)return;const i=new J(this._gl,this._program,t,e.toFloatArray());this.setAttribute(i)}setConstantMatAttribute(t,e){if(!t||!e)return;const i=new J(this._gl,this._program,t,e.toFloatArray());this.setAttribute(i)}setBufferAttribute(t,e,i){if(!t||!e?.length)return;const s=new tt(this._gl,this._program,t,e,i);this.setAttribute(s)}setIndexAttribute(t){if(!t?.length)return;if(!this._extIndexed&&t instanceof Uint32Array)throw new Error("'OES_element_index_uint' extension not supported");const e=new et(this._gl,this._program,t);this.setAttribute(e)}updateBufferAttribute(t,e,i){if(!t||!e)return;const s=this._attributes.get(t);s instanceof tt&&s.updateData(e,i)}deleteAttribute(t){const e=this._attributes.get(t);e&&(e.destroy(),this._attributes.delete(t))}clearAttributes(){this._attributes.forEach(((t,e)=>this.deleteAttribute(e)))}setBoolUniform(t,e){const i=new st(this._gl,this._program,t,b,e?1:0);this.setUniform(i)}setBoolArrayUniform(t,e){if(!t||!e?.length)return;const i=new Int32Array(e.length);for(let t=0;t<e.length;t++)i[t]=e[t]?1:0;const s=new nt(this._gl,this._program,t,E,i);this.setUniform(s)}setIntUniform(t,e){if(!t||isNaN(e))return;const i=new st(this._gl,this._program,t,b,e);this.setUniform(i)}setIntArrayUniform(t,e){if(!t||!e?.length)return;const i=new nt(this._gl,this._program,t,b,e);this.setUniform(i)}setIntVecUniform(t,e){if(!t||!e)return;let i;switch(e.length){case 2:i=C;break;case 3:i=D;break;case 4:i=L;break;default:throw new Error("Incorrect vector length")}const s=new nt(this._gl,this._program,t,i,e.toIntArray());this.setUniform(s)}setFloatUniform(t,e){if(!t||isNaN(e))return;const i=new rt(this._gl,this._program,t,e);this.setUniform(i)}setFloatArrayUniform(t,e){if(!t||!e?.length)return;const i=new at(this._gl,this._program,t,M,e);this.setUniform(i)}setFloatVecUniform(t,e){if(!t||!e)return;let i;switch(e.length){case 2:i=F;break;case 3:i=S;break;case 4:i=U;break;default:throw new Error("Incorrect vector length")}const s=new at(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(s)}setFloatMatUniform(t,e){if(!t||!e)return;let i;switch(e.length){case 4:i=I;break;case 9:i=P;break;case 16:i=R;break;default:throw new Error("Incorrect matrix length")}const s=new at(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(s)}createTexture(t,e,i,s,n,a){if(t instanceof Uint8Array){if(s!==g)throw new Error("Invalid texel type")}else if(!(t instanceof Uint16Array))throw new Error("Invalid data array type");if(t.length!==n*a)throw new Error("Invalid data array length");const o=this._gl,h=o.createTexture();return o.bindTexture(e,h),o.texImage2D(e,0,i,n,a,0,i,s,t),r(n)&&r(a)?o.generateMipmap(e):(o.texParameteri(e,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(e,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(e,o.TEXTURE_MIN_FILTER,o.LINEAR)),h}loadTexture(t,e=new Uint8Array([0,0,0,255])){if(!(t&&e instanceof Uint8Array))throw new Error("Invalid arguments");const i=this._gl,s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);const n=i.RGBA,a=i.RGBA,o=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,n,1,1,0,a,o,e);const h=new Image;return h.onload=function(){i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,n,a,o,h),r(h.width)&&r(h.height)?i.generateMipmap(i.TEXTURE_2D):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR))},h.src=t,s}setTexture(t,e,i=N,s=0){if(!t||!e)return;const r=new ht(this._gl,this._program,t,s,e,i);this._uniforms.set(t,r)}setTextureArray(t,e,i=N,s=0){if(!t||!e?.length)return;const r=new _t(this._gl,this._program,t,s,e,i);this._uniforms.set(t,r)}createAndSet2dTexture(t,e,i,s,r,n,a,o=0){if(!t)return;const h=this.createTexture(e,i,s,r,n,a);this.setTexture(t,h,i,o)}loadAndSet2dTexture(t,e,i=0,s=new Uint8Array([0,0,0,255])){if(!t)return;const r=this.loadTexture(e,s);this.setTexture(t,r,N,i)}deleteUniform(t){const e=this._uniforms.get(t);e&&(e.destroy(),this._uniforms.delete(t))}clearUniforms(){this._uniforms.forEach(((t,e)=>this.deleteUniform(e)))}setAttribute(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._attributes.set(t.name,t)}setUniform(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._uniforms.set(t.name,t)}set(){this._gl.useProgram(this._program),this._attributes.forEach((t=>t.set())),this._uniforms.forEach((t=>t.set()))}}class ct extends lt{constructor(t,e,i){if(super(t,e,i),this._instanceCount=0,this._extInstanced=t.getExtension("ANGLE_instanced_arrays"),!this._extInstanced)throw this.destroy(),new Error("'ANGLE_instanced_arrays' extension not supported")}get instanceCount(){return this._instanceCount}set instanceCount(t){this._instanceCount=Math.max(0,t)}render(t=!0){this._gl.viewport(0,0,this._gl.canvas.width,this._gl.canvas.height),t&&this.resetRender(),this.set();const e=this._attributes.get("index");e?this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,3*this._triangleCount,e.type,this._offset,this._instanceCount):this._extInstanced.drawArraysInstancedANGLE(this._gl.TRIANGLES,this._offset,3*this._triangleCount,this._instanceCount)}setInstancedBufferAttribute(t,e,i){if(!e?.length)return;const s=new tt(this._gl,this._program,t,e,i,this._extInstanced);this.setAttribute(s)}}class ut{constructor(t,e,i){this._resolution=new h,this._pointerPosition=new h,this._animationStartTimeStamp=0,this._lastFrameTimeStamp=0,this._lastPreparationTime=0,this._lastRenderTime=0,this.onResize=()=>{const t=window.devicePixelRatio,e=this._container.getBoundingClientRect(),i=Math.floor(e.width*t),s=Math.floor(e.height*t);this._resolution.set(i,s)},this.onPointerMove=t=>{const e=window.devicePixelRatio,i=this._container.getBoundingClientRect(),s=i.left+document.documentElement.scrollLeft,r=i.top+document.documentElement.scrollTop,n=(t.clientX-s+window.pageXOffset)*e,a=(t.clientY-r+window.pageYOffset)*e;this._pointerPosition.set(n,a)},this.onPointerDown=()=>{this._pointerIsDown=!0},this.onPointerUp=()=>{this._pointerIsDown=!1},this._options=e,this._container=t,this._controlType=i,this.initCanvas(),this.initControl(),this.addEventListeners()}destroy(){this.stop(),this.removeEventListeners(),this._control.destroy(),this._canvas.remove()}start(){if(this._animationStartTimeStamp){const t=performance.now()-this._lastFrameTimeStamp;this._animationStartTimeStamp+=t}this._animationTimerId=setInterval((()=>{const t=performance.now(),e=t-this._animationStartTimeStamp;this._control.prepareNextFrame(this._resolution,this._pointerPosition,this._pointerIsDown,e);const i=performance.now();this._lastPreparationTime=i-t,requestAnimationFrame((()=>{const t=performance.now();this._control.renderFrame();const e=performance.now();this._lastFrameTimeStamp=e,this._lastRenderTime=e-t}))}),1e3/this._options.expectedFps)}pause(){this._animationTimerId&&(clearInterval(this._animationTimerId),this._animationTimerId=null)}stop(){this.pause(),this._animationStartTimeStamp=0,window.setTimeout((()=>this._control.clear()),20)}initCanvas(){const t=document.createElement("canvas");t.id=crypto.getRandomValues(new Uint32Array(4)).join("-"),t.style.display="block",t.style.width="100%",t.style.height="100%",t.style.filter=`blur(${this._options.blur}px)`,this._container.append(t),this._canvas=t,this.onResize()}initControl(){this._control=new this._controlType(this._canvas.getContext("webgl"),this._options)}addEventListeners(){this._resizeObserver=new ResizeObserver(this.onResize),this._resizeObserver.observe(this._container),this._container.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointerup",this.onPointerUp),window.addEventListener("blur",this.onPointerUp)}removeEventListeners(){this._resizeObserver.unobserve(this._container),this._resizeObserver.disconnect(),this._resizeObserver=null,this._container.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("blur",this.onPointerUp)}}class xt{constructor(t){this._dimensions=new _,this._sceneDimensions=new a,this._options=t,this._margin=Math.max(0,t.size[1],t.lineLength,t.onHoverLineLength),this._doubleMargin=2*this._margin;const e=new $(1);this._primitive=e}get position(){return this._primitive.positions}get uv(){return this._primitive.uvs}get index(){return this._primitive.indices}get triangles(){return this._primitive.indices.length/3}get length(){return this._length}get color(){return this._iColors}get matrix(){const t=new Float32Array(16*this._length);for(let e=0;e<this._length;e++)t.set(this._iMatrices[e].toFloatArray(),16*e);return t}get sceneDimensions(){return this._sceneDimensions}updateData(t,e,i,s){this.updateDimensions(t)&&this.updateLength();const{x:r,y:n,z:a}=this._sceneDimensions,o=s,_=new h;for(let t=0;t<this._length;t++){const e=this._iSizes[3*t]/r,i=this._iSizes[3*t+1]/n,s=this._iSizes[3*t+2],h=this._iBasePositions[3*t],l=this._iBasePositions[3*t+1],c=this._iBasePositions[3*t+2],u=this._iVelocities[3*t],x=this._iVelocities[3*t+1],y=this._iAngularVelocities[t],[m,d]=this.getSceneDimensionsAtZ(c*a,_),w=m/r,g=d/n,f=(h+o*u/r)%w,p=(l+o*x/n)%g,z=(f<0?f+w:f)-w/2,v=(p<0?p+g:p)-g/2,b=c;this._iCurrentPositions[3*t]=z,this._iCurrentPositions[3*t+1]=v,this._iCurrentPositions[3*t+2]=b,this._iMatrices[t].reset().applyRotation("z",o*y%(2*Math.PI)).applyScaling(e,i,s).applyTranslation(z,v,b)}this._iMatrices.sort(((t,e)=>t.w_z-e.w_z))}getSceneDimensionsAtZ(t,e){const s=this._dimensions.w;t<s?t-=s:t+=s;const r=i(this._options.fov),n=2*Math.tan(r/2)*Math.abs(t),a=n/this._dimensions.y*this._dimensions.x;return e?e.set(a+this._doubleMargin,n+this._doubleMargin):new h(a+this._doubleMargin,n+this._doubleMargin)}updateDimensions(t){const e=!t.equals(this._dimensions);return e&&(this._dimensions.setFromVec4(t),this._sceneDimensions.set(t.x+this._doubleMargin,t.y+this._doubleMargin,t.z)),e}updateLength(){const t=Math.floor(this._options.fixedNumber??this._options.density*this._sceneDimensions.x*this._sceneDimensions.y);if(this._length!==t){const s=4*t,r=new Float32Array(s),n=this._iColors,a=n?.length||0,h=Math.min(s,a);a&&r.set(n.subarray(0,h),0);for(let t=h;t<s;){const s=(i=this._options.colors)[Math.floor(Math.random()*i.length)];r[t++]=s[0]/255,r[t++]=s[1]/255,r[t++]=s[2]/255,r[t++]=this._options.fixedOpacity||e(this._options.opacityMin??0,1)}this._iColors=r.sort();const _=3*t,l=new Float32Array(_),c=this._iSizes,u=c?.length||0,x=Math.min(_,u);u&&l.set(c.subarray(0,x),0);for(let t=x;t<_;){const i=e(this._options.size[0],this._options.size[1]);l[t++]=i,l[t++]=i,l[t++]=1}this._iSizes=l;const y=3*t,m=new Float32Array(y),d=this._iBasePositions,w=d?.length||0,g=Math.min(y,w);w&&m.set(d.subarray(0,g),0);for(let t=g;t<y;t+=3)m.set([e(0,1),e(0,1),e(-1,0)],t);this._iBasePositions=m;const f=3*t,p=new Float32Array(f),z=this._iVelocities,v=z?.length||0,b=Math.min(f,v);v&&p.set(z.subarray(0,b),0);for(let t=b;t<f;)p[t++]=e(this._options.velocityX[0],this._options.velocityX[1]),p[t++]=e(this._options.velocityY[0],this._options.velocityY[1]),p[t++]=1;this._iVelocities=p;const A=t,M=new Float32Array(A),E=this._iAngularVelocities,T=E?.length||0,F=Math.min(A,T);T&&M.set(E.subarray(0,F),0);for(let t=F;t<A;t++)M[t]=e(this._options.angularVelocity[0],this._options.angularVelocity[1]);this._iAngularVelocities=M,this._iCurrentPositions=new Float32Array(3*t);const S=new Array(t);for(let e=0;e<t;e++)S[e]=new o;this._iMatrices=S,this._length=t}var i}}class yt{constructor(t,e){if(this._vertexShader="\n    #pragma vscode_glsllint_stage : vert\n\n    attribute vec4 aColorInst;\n    attribute vec3 aPosition;\n    attribute vec2 aUv;\n    attribute vec2 aUvInst;\n    attribute mat4 aMatInst;\n\n    uniform int uTexSize;\n    uniform vec2 uResolution;\n    uniform mat4 uModel;\n    uniform mat4 uView;\n    uniform mat4 uProjection;\n    \n    varying vec4 vColor;\n    varying vec2 vUv;\n\n    void main() {\n      vColor = aColorInst;\n\n      float texSize = float(uTexSize);\n      vUv = vec2((aUvInst.x + aUv.x) / texSize, (aUvInst.y + aUv.y) / texSize);\n\n      gl_Position = uProjection * uView * uModel * aMatInst * vec4(aPosition, 1.0);\n    }\n  ",this._fragmentShader="\n    #pragma vscode_glsllint_stage : frag  \n\n    precision highp float;\n\n    uniform sampler2D uTex;\n\n    varying vec4 vColor;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 color = texture2D(uTex, vUv);\n      gl_FragColor = color * vColor;\n    }\n  ",this._lastResolution=new h,this._dimensions=new _,this._gl=t,this.fixContext(),this._fov=e.fov,this._depth=e.depth,this._program=new ct(t,this._vertexShader,this._fragmentShader),this._data=new xt(e),!e.textureUrl)throw new Error("Texture URL not defined");this._textureMap=e.textureMap,this._program.loadAndSet2dTexture("uTex",e.textureUrl),this._program.setIntUniform("uTexSize",e.textureSize||1),this._program.setBufferAttribute("aPosition",this._data.position,{vectorSize:3}),this._program.setBufferAttribute("aUv",this._data.uv,{vectorSize:2}),this._program.setIndexAttribute(this._data.index)}prepareNextFrame(t,e,s,r){if(!t.equals(this._lastResolution)){const n=Math.tan(.5*Math.PI-.5*i(this._fov))*t.y/2;this.resize(t),this._program.setIntVecUniform("uResolution",t),this._lastResolution.setFromVec2(t),this._dimensions.set(t.x,t.y,this._depth,n),this._data.updateData(this._dimensions,e,s,r);const a=(new o).applyTranslation(0,0,-n);this._program.setFloatMatUniform("uView",a);const h=this._data.sceneDimensions,_=(new o).applyScaling(h.x,h.y,this._depth);this._program.setFloatMatUniform("uModel",_);const l=o.buildPerspective(n,n+this._depth+1,-t.x/2,t.x/2,-t.y/2,t.y/2);this._program.setFloatMatUniform("uProjection",l),this._program.setInstancedBufferAttribute("aMatInst",this._data.matrix,{vectorSize:4,vectorNumber:4,divisor:1,usage:H}),this._program.setInstancedBufferAttribute("aColorInst",this._data.color,{vectorSize:4,vectorNumber:1,divisor:1,usage:j});const c=new Float32Array(2*this._data.length);for(let t=0;t<c.length;t++)c[t]=this._textureMap[t%this._textureMap.length];this._program.setInstancedBufferAttribute("aUvInst",c,{vectorSize:2,divisor:1,usage:j})}else this._data.updateData(this._dimensions,e,s,r);this._program.updateBufferAttribute("aMatInst",this._data.matrix,0)}renderFrame(){this._program.triangleCount=this._data.triangles,this._program.instanceCount=this._data.length,this._program.render()}clear(){this._program.resetRender()}destroy(){this._program.destroy(),this._gl.getExtension("WEBGL_lose_context").loseContext()}resize(t){this._gl.canvas.width=t.x,this._gl.canvas.height=t.y}fixContext(){this._gl.isContextLost()&&this._gl.getExtension("WEBGL_lose_context").restoreContext()}}t.AnimationFactory=class{static createDotsAnimation(t,e=null){const i=document.querySelector(t);if(!i)throw new Error("Container not found");if("static"===window.getComputedStyle(i).getPropertyValue("position"))throw new Error("Container is not positioned");const s=new l(e);return new ut(i,s,yt)}},Object.defineProperty(t,"__esModule",{value:!0})}));
