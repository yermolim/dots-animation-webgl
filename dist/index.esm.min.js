class t{constructor(t=0,e=0){this.length=2,this.x=t,this.y=e}static multiplyByScalar(e,i){return new t(e.x*i,e.y*i)}static addScalar(e,i){return new t(e.x+i,e.y+i)}static normalize(e){return(new t).setFromVec2(e).normalize()}static add(e,i){return new t(e.x+i.x,e.y+i.y)}static substract(e,i){return new t(e.x-i.x,e.y-i.y)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,i){return t.clone().lerp(e,i)}static rotate(t,e,i){return t.clone().rotate(e,i)}static equals(t,e,i=6){return t.equals(e)}static getDistance(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}clone(){return new t(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(e){return t.dotProduct(this,e)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:i}=this,[r,s,,n,o,,a,h]=t;return this.x=e*r+i*n+a,this.y=e*s+i*o+h,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this}rotate(t,e){const i=Math.sin(e),r=Math.cos(e),s=this.x-t.x,n=this.y-t.y;return this.x=s*r-n*i+t.x,this.y=s*i+n*r+t.y,this}equals(t,e=6){return+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class e{constructor(t=null){this.expectedFps=60,this.number=null,this.density=5e-5,this.dprDependentDensity=!0,this.dprDependentDimensions=!0,this.minR=1,this.maxR=6,this.minSpeedX=-.5,this.maxSpeedX=.5,this.minSpeedY=-.5,this.maxSpeedY=.5,this.blur=1,this.fill=!0,this.colorsFill=["#ffffff","#fff4c1","#faefdb"],this.opacityFill=null,this.opacityFillMin=0,this.opacityFillStep=0,this.stroke=!1,this.colorsStroke=["#ffffff"],this.opacityStroke=1,this.opacityStrokeMin=0,this.opacityStrokeStep=0,this.drawLines=!0,this.lineColor="#717892",this.lineLength=150,this.lineWidth=2,this.actionOnClick=!0,this.actionOnHover=!0,this.onClickCreate=!1,this.onClickMove=!0,this.onHoverMove=!0,this.onHoverDrawLines=!0,this.onClickCreateNDots=10,this.onClickMoveRadius=200,this.onHoverMoveRadius=50,this.onHoverLineRadius=150,t&&Object.assign(this,t)}}const i=35632,r=35633,s=34962,n=34963,o=5120,a=5121,h=5122,l=5123,c=5124,_=5125,u=5126,f=35670,d={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4},g=35664,m=35665,p=35666,y=35674,w=35675,v=35676,b=35667,x=35668,A=35669,E=35671,S=35672,U=35673;function k(t){if(t instanceof Int8Array)return o;if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return a;if(t instanceof Int16Array)return h;if(t instanceof Uint16Array)return l;if(t instanceof Int32Array)return c;if(t instanceof Uint32Array)return _;if(t instanceof Float32Array)return u;throw new Error("Unsupported array type")}class F{constructor(t,e,i){this._gl=t,this._location=t.getAttribLocation(e,i),this._name=i}get name(){return this._name}get type(){return this._type}}class C extends F{constructor(t,e,i,r){if(super(t,e,i),this._type=k(r),this._size=r.length,![1,2,3,4,9,16].includes(this._size))throw new Error("Incorrect constant value length")}set(){switch(this._gl.disableVertexAttribArray(this._location),this._type){case u:switch(this._size){case 1:this._gl.vertexAttrib1f(this._location,this._values[0]);break;case 2:this._gl.vertexAttrib2fv(this._location,this._values);break;case 3:this._gl.vertexAttrib3fv(this._location,this._values);break;case 4:this._gl.vertexAttrib4fv(this._location,this._values);break;case 9:const[t,e,i,r,s,n,o,a,h]=this._values;this._gl.vertexAttrib3f(this._location,t,e,i),this._gl.vertexAttrib3f(this._location+1,r,s,n),this._gl.vertexAttrib3f(this._location+2,o,a,h);break;case 16:const[l,c,_,u,f,d,g,m,p,y,w,v,b,x,A,E]=this._values;this._gl.vertexAttrib4f(this._location,l,c,_,u),this._gl.vertexAttrib4f(this._location+1,f,d,g,m),this._gl.vertexAttrib4f(this._location+2,p,y,w,v),this._gl.vertexAttrib4f(this._location+3,b,x,A,E);break;default:throw new Error("Incorrect constant value length")}break;default:throw new Error("Unsupported constant attribute type")}}destroy(){}}class I extends F{constructor(t,e,i,r,n){super(t,e,i),this._type=k(r);const{usage:o,vectorSize:a,vectorNumber:h,stride:l,offset:c,normalize:_}=Object.assign(I.defaultOptions,n);let u=0;1!==h?(u=a*h*d[this.type],this._vectorOffset=this._stride/h):this._vectorOffset=0,this._vectorSize=a,this._vectorNumber=h,this._offset=c,this._stride=Math.min(255,Math.max(u,l)),this._normalize=_,this._buffer=t.createBuffer(),t.bindBuffer(s,this._buffer),t.bufferData(s,r,o)}updateData(t,e){this._gl.bindBuffer(s,this._buffer),this._gl.bufferSubData(s,e,t)}set(){this._gl.bindBuffer(s,this._buffer);for(let t=0,e=this._location;t<this._vectorNumber;t++,e++)this._gl.enableVertexAttribArray(e),this._gl.vertexAttribPointer(e,this._vectorSize,this._type,this._normalize,this._stride,this._offset+t*this._vectorOffset)}destroy(){this._gl.deleteBuffer(this._buffer)}}I.defaultOptions={usage:35044,vectorSize:1,vectorNumber:1,stride:0,offset:0,normalize:!1};class T extends F{constructor(t,e,i){let r;if(super(t,e,"index"),i instanceof Uint8Array||i instanceof Uint8ClampedArray)r=a;else if(i instanceof Uint16Array)r=l;else{if(!(i instanceof Uint32Array))throw new Error("Unsupported index type");r=_}this._type=r,this._buffer=t.createBuffer(),this._gl.bindBuffer(s,this._buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW)}set(){this._gl.bindBuffer(n,this._buffer)}destroy(){this._gl.deleteBuffer(this._buffer)}}class P{constructor(t,e,i){this._gl=t,this._location=t.getUniformLocation(e,this._name),this._name=i}get name(){return this._name}get type(){return this._type}setSampleArray(t,e,i){}}class L extends P{constructor(t,e,i,r,s){super(t,e,i),this._value=s,this._type=r}set(){this._gl.uniform1i(this._location,this._value)}destroy(){}}class M extends P{constructor(t,e,i,r){super(t,e,i),this._type=5126,this._value=r}set(){this._gl.uniform1f(this._location,this._value)}destroy(){}}class z extends P{constructor(t,e,i,r,s){switch(super(t,e,i),this._values=s,r){case c:case f:break;case b:case E:if(2!==s.length)throw new Error("Wrong values array length for a defined type");break;case x:case S:if(3!==s.length)throw new Error("Wrong values array length for a defined type");break;case A:case U:if(4!==s.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}this._type=r}set(){switch(this._type){case c:case f:this._gl.uniform1iv(this._location,this._values);break;case b:case E:this._gl.uniform2iv(this._location,this._values);break;case x:case S:this._gl.uniform3iv(this._location,this._values);break;case A:case U:this._gl.uniform4iv(this._location,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformIntArrayInfo`)}}destroy(){}}class B extends P{constructor(t,e,i,r,s){switch(super(t,e,i),this._values=s,r){case u:break;case g:if(2!==s.length)throw new Error("Wrong values array length for a defined type");break;case m:if(3!==s.length)throw new Error("Wrong values array length for a defined type");break;case p:case y:if(4!==s.length)throw new Error("Wrong values array length for a defined type");break;case w:if(9!==s.length)throw new Error("Wrong values array length for a defined type");break;case v:if(16!==s.length)throw new Error("Wrong values array length for a defined type");break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}this._type=r}set(){switch(this._type){case u:this._gl.uniform1fv(this._location,this._values);break;case g:this._gl.uniform2fv(this._location,this._values);break;case m:this._gl.uniform3fv(this._location,this._values);break;case p:this._gl.uniform4fv(this._location,this._values);break;case y:this._gl.uniformMatrix2fv(this._location,!1,this._values);break;case w:this._gl.uniformMatrix3fv(this._location,!1,this._values);break;case v:this._gl.uniformMatrix4fv(this._location,!1,this._values);break;default:throw new Error(`Uniforms of type '${this._type}' are not supported by UniformFloatArrayInfo`)}}destroy(){}}class R{constructor(t,e,s){this._attributes=new Map,this._uniforms=new Map,this._offset=0,this._triangleCount=0;const n=R.loadShader(t,r,e),o=R.loadShader(t,i,s);this._extIndexed=t.getExtension("OES_element_index_uint");const a=t.createProgram();t.attachShader(a,n),t.attachShader(a,o),this._gl=t,this._program=a,t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS)){const e=t.getProgramInfoLog(a);throw this.destroy(),new Error("Error while linking program: "+e)}}get offset(){return this._offset}set offset(t){this._offset=Math.max(0,t)}get triangleCount(){return this._triangleCount}set triangleCount(t){this._triangleCount=Math.max(0,t)}static loadShader(t,e,i){const r=t.createShader(e);t.shaderSource(r,i),t.compileShader(r);if(!t.getShaderParameter(r,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error("Error while compiling shader: "+e)}return r}render(t=!0){t&&this.clear(),this.set();const e=this._attributes.get("index");e?this._gl.drawElements(this._gl.TRIANGLES,3*this._triangleCount,e.type,this._offset):this._gl.drawArrays(this._gl.TRIANGLES,this._offset,3*this._triangleCount)}clear(){this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.DEPTH_TEST),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT)}destroy(){this.clearUniforms(),this.clearAttributes(),this._gl.deleteProgram(this._program),this._gl.deleteShader(this._vertexShader),this._gl.deleteShader(this._fragmentShader)}setConstantScalarAttribute(t,e){if(isNaN(e))return;const i=new C(this._gl,this._program,t,new Float32Array([e]));this.setAttribute(i)}setConstantVecAttribute(t,e){if(!e)return;const i=new C(this._gl,this._program,t,e.toFloatArray());this.setAttribute(i)}setConstantMatAttribute(t,e){if(!e)return;const i=new C(this._gl,this._program,t,e.toFloatArray());this.setAttribute(i)}setBufferAttribute(t,e,i){if(!e?.length)return;const r=new I(this._gl,this._program,t,e,i);this.setAttribute(r)}setIndexAttribute(t){if(!t?.length)return;if(!this._extIndexed&&t instanceof Uint32Array)throw new Error("'OES_element_index_uint' extension not supported");const e=new T(this._gl,this._program,t);this.setAttribute(e)}updateBufferAttribute(t,e,i){const r=this._attributes.get(t);r instanceof I&&r.updateData(e,i)}deleteAttribute(t){const e=this._attributes.get(t);e&&(e.destroy(),this._attributes.delete(t))}clearAttributes(){this._attributes.forEach(((t,e)=>this.deleteAttribute(e)))}setBoolUniform(t,e){const i=new L(this._gl,this._program,t,c,e?1:0);this.setUniform(i)}setBoolArrayUniform(t,e){if(!e?.length)return;const i=new Int32Array(e.length);for(let t=0;t<e.length;t++)i[t]=e[t]?1:0;const r=new z(this._gl,this._program,t,f,i);this.setUniform(r)}setIntUniform(t,e){const i=new L(this._gl,this._program,t,c,e);this.setUniform(i)}setIntArrayUniform(t,e){if(!e?.length)return;const i=new z(this._gl,this._program,t,c,e);this.setUniform(i)}setIntVecUniform(t,e){if(!e)return;let i;switch(e.length){case 2:i=b;break;case 3:i=x;break;case 4:i=A;break;default:throw new Error("Incorrect vector length")}const r=new z(this._gl,this._program,t,i,e.toIntArray());this.setUniform(r)}setFloatUniform(t,e){const i=new M(this._gl,this._program,t,e);this.setUniform(i)}setFloatArrayUniform(t,e){if(!e?.length)return;const i=new B(this._gl,this._program,t,u,e);this.setUniform(i)}setFloatVecUniform(t,e){if(!e)return;let i;switch(e.length){case 2:i=g;break;case 3:i=m;break;case 4:i=p;break;default:throw new Error("Incorrect vector length")}const r=new B(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(r)}setFloatMatUniform(t,e){if(!e)return;let i;switch(e.length){case 4:i=y;break;case 9:i=w;break;case 16:i=v;break;default:throw new Error("Incorrect matrix length")}const r=new B(this._gl,this._program,t,i,e.toFloatArray());this.setUniform(r)}setTexture(){}setTextureArray(){}deleteUniform(t){const e=this._uniforms.get(t);e&&(e.destroy(),this._uniforms.delete(t))}clearUniforms(){this._uniforms.forEach(((t,e)=>this.deleteUniform(e)))}setAttribute(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._attributes.set(t.name,t)}setUniform(t){const e=this._attributes.get(t.name);e&&e.destroy(),this._uniforms.set(t.name,t)}set(){this._gl.useProgram(this._program),this._attributes.forEach((t=>t.set())),this._uniforms.forEach((t=>t.set()))}}class D{constructor(e,i,r){this._resolution=new t,this._pointerPosition=new t,this._animationStartTimeStamp=0,this._lastFrameTimeStamp=0,this._lastFrameTime=0,this._lastFramePreparationTime=0,this._lastFrameRenderTime=0,this.onResize=t=>{const e=window.devicePixelRatio,i=this._container.getBoundingClientRect(),r=i.width*e,s=i.height*e;this._canvas.width=r,this._canvas.height=s,this._resolution.set(r,s)},this.onPointerMove=t=>{const e=window.devicePixelRatio,i=this._container.getBoundingClientRect(),r=i.left+document.documentElement.scrollLeft,s=i.top+document.documentElement.scrollTop,n=(t.clientX-r+window.pageXOffset)*e,o=(t.clientY-s+window.pageYOffset)*e;this._pointerPosition.set(n,o)},this.onPointerDown=t=>{this._pointerIsDown=!0},this.onPointerUp=()=>{this._pointerIsDown=!1},this._options=i,this._container=e,this._controlType=r,this.initCanvas(),this.initControl(),this.addEventListeners()}destroy(){this.stop(),this.removeEventListeners(),this._control.destroy(),this._canvas.remove()}start(){if(this._animationStartTimeStamp){const t=performance.now()-this._lastFrameTimeStamp;this._animationStartTimeStamp+=t}this._animationTimerId=setInterval((()=>{const t=performance.now(),e=t-this._animationStartTimeStamp;this._control.prepareNextFrame(this._resolution,this._pointerPosition,this._pointerIsDown,e),this._lastFramePreparationTime=performance.now()-t,requestAnimationFrame((()=>{const e=performance.now();this._control.renderFrame();const i=performance.now();this._lastFrameTimeStamp=i,this._lastFrameRenderTime=i-e,this._lastFrameTime=i-t}))}),1e3/this._options.expectedFps)}pause(){this._animationTimerId&&(clearInterval(this._animationTimerId),this._animationTimerId=null)}stop(){this.pause(),this._animationStartTimeStamp=0,window.setTimeout((()=>this._control.clear()),20)}initCanvas(){const t=document.createElement("canvas");t.id=crypto.getRandomValues(new Uint32Array(4)).join("-"),t.style.display="block",t.style.width="100%",t.style.height="100%",t.style.filter=`blur(${this._options.blur}px)`,this._container.append(t),this._canvas=t,this.onResize(null)}initControl(){this._control=new this._controlType(this._canvas.getContext("webgl"),this._options)}addEventListeners(){this._resizeObserver=new ResizeObserver(this.onResize),this._resizeObserver.observe(this._container),this._container.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointerup",this.onPointerUp),window.addEventListener("blur",this.onPointerUp)}removeEventListeners(){this._resizeObserver.unobserve(this._container),this._resizeObserver.disconnect(),this._resizeObserver=null,this._container.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("blur",this.onPointerUp)}}class O{constructor(t,e){this._vertexShader="\n    #pragma vscode_glsllint_stage : vert\n\n    attribute vec4 position;\n\n    void main() {\n      gl_Position = position;\n    }\n  ",this._fragmentShader="\n    #pragma vscode_glsllint_stage : frag  \n\n    precision mediump float;\n\n    void main() {\n      gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n  ",this._options=e,this._gl=t,this._gl.isContextLost()&&this._gl.getExtension("WEBGL_lose_context").restoreContext(),this._program=new R(t,this._vertexShader,this._fragmentShader),this._tempData=new Float32Array([.1,.5,0,1,.3,.1,0,1,.3,.5,0,1]),this._program.setBufferAttribute("position",this._tempData,{vectorSize:4}),this._program.triangleCount=1}prepareNextFrame(t,e,i,r){this.resize(t)}renderFrame(){this._program.render()}clear(){this._program.clear()}destroy(){this._program.destroy(),this._gl.getExtension("WEBGL_lose_context").loseContext()}resize(t){this._gl.canvas.width!==t.x&&(this._gl.canvas.width=t.x),this._gl.canvas.height!==t.y&&(this._gl.canvas.height=t.y)}}class N{static createDotsAnimation(t,i=null){const r=document.querySelector(t);if(!r)throw new Error("Container not found");if("static"===window.getComputedStyle(r).getPropertyValue("position"))throw new Error("Container is not positioned");const s=new e(i);return new D(r,s,O)}}export{N as AnimationFactory};
